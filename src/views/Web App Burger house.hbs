<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/stylesheets/main_style.css">
    <title>БурGер house</title>
</head>
<body>
    <div class="main">
        <div class="upline">
            <div></div>
            <div>
                <button id="menu_button">Menu</button>
            </div>
        </div>
        <div class="dropdown-menu" id="dropdownMenu">
            <a href="auth/register">Войти в аккаунт</a>
            <a href="/cart">Корзина</a>
        </div>

        <div class="maintext">
            <h1 style="color: rgb(255, 205, 10);">БурGер house. Все дороги ведут к нам</h1>
        </div>

        <div class="switchmenu">
            {{#if dishes.length}}
                {{#each dishes}}
                    <div class="burgers">
                        <h1>{{this.name}}</h1>
                        <p>{{this.description}}</p>
                        <p>Калории: {{this.calories}}</p>
                        <p>Цена: {{this.price}}$</p>   
                        <button class="add_button" data-id="{{this.id}}" data-name="{{this.name}}" data-price="{{this.price}}">Добавить в корзину</button>  
                    </div>
                {{/each}}
            {{else}}
                <p>Блюда не найдены.</p>
            {{/if}}
        </div>


        <div class="stillmenu">
            <img src="/images/chickens.jpg" alt="Куриные бургеры">
            <img src="/images/goviadines.jpg" alt="Говяжьи бургеры">
            <img src="/images/pigs.jpg" alt="Свиные бургеры">
            <img src="/images/shaurmas.jpg" alt="Шаурма">
            <img src="/images/hlebs.jpg" alt="Сэндвичи">
            <img src="/images/fris.jpg" alt="Фри">
        </div>
    </div>

    <div id="modal" class="modal">
        <span class="close">&times;</span>
        <img id="modalImage" class="modal-content">
        <a class="prev">&#10094;</a>
        <a class="next">&#10095;</a>
    </div>

    <script>
        const images = document.querySelectorAll('.stillmenu img');
        const modal = document.getElementById('modal');
        const modalImage = document.getElementById('modalImage');
        const closeBtn = document.querySelector('.close');
        const prevBtn = document.querySelector('.prev');
        const nextBtn = document.querySelector('.next');

        let currentIndex = 0;

        images.forEach((img, index) => {
            img.addEventListener('click', () => {
                modal.style.display = 'flex';
                modalImage.src = img.src;
                currentIndex = index;
            });
        });

        closeBtn.addEventListener('click', () => {
            modal.style.display = 'none';
        });

        nextBtn.addEventListener('click', () => {
            currentIndex = (currentIndex + 1) % images.length;
            modalImage.src = images[currentIndex].src;
        });

        prevBtn.addEventListener('click', () => {
            currentIndex = (currentIndex - 1 + images.length) % images.length;
            modalImage.src = images[currentIndex].src;
        });

        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.style.display = 'none';
            }
        });
       //кнопка Добавить в корзину
        document.querySelectorAll('.add_button').forEach(button => {
    button.addEventListener('click', async function() {
        const dishId = this.getAttribute('data-id');
        const dishName = this.getAttribute('data-name');
        const dishPrice = parseFloat(this.getAttribute('data-price'));

        try {
            const response = await fetch('/cart/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ dishId, quantity: 1 }) 
            });

            if (response.ok) {
                const item = await response.json();
                alert(`${item.name} добавлен в корзину!`); 
            } else {
                console.error('Ошибка при добавлении в корзину');
            }
        } catch (error) {
            console.error('Ошибка:', error);
        }
    });
});

        // Меню
        document.getElementById('menu_button').addEventListener('click', function() {
            var dropdownMenu = document.getElementById('dropdownMenu');
            dropdownMenu.classList.toggle('show');
        });

        window.onclick = function(event) {
            var dropdownMenu = document.getElementById('dropdownMenu');
            var menuButton = document.getElementById('menu_button');

            if (!event.target.matches('#menu_button') && !event.target.closest('.dropdown-menu')) {
                dropdownMenu.classList.remove('show');
                menuButton.style.opacity = 1; 
                menuButton.style.pointerEvents = 'auto'; 
            }
        };
    </script>
</body>
</html>